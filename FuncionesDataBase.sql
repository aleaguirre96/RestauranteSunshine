USE  DataBaseRestaurante;
CREATE USER 'userconect'@'%' IDENTIFIED BY 'userconect';	
GRANT ALL PRIVILEGES ON  DataBaseRestaurante.* TO 'userconect'@'%';

DELIMITER //
CREATE PROCEDURE `raise`(`errno` BIGINT UNSIGNED, `message` VARCHAR(256))
BEGIN
SIGNAL SQLSTATE
    'ERR0R'
SET
    MESSAGE_TEXT = `message`,
    MYSQL_ERRNO = `errno`;
END //
DELIMITER ;



DELIMITER //
#Agregar Usuarios
CREATE PROCEDURE ADDNEWUSERCLIENT(IN IN_USERNAME VARCHAR(20), 
                            IN IN_USERPASSWORD VARCHAR(15))
BEGIN
    DECLARE CONT INTEGER DEFAULT 0;
	
	SELECT COUNT(USERNAME)
	INTO CONT
	FROM UsersEmpl
	WHERE IN_USERNAME = USERNAME;
    
    IF(CONT = 0) THEN 
		INSERT INTO UsersClient(USERNAME,USERPASSWORD)
		VALUES(IN_USERNAME, IN_USERPASSWORD);
	ELSE 
       call `raise`(0001, 'Usuario ya existente');
    END IF;
END //
DELIMITER ;


call ADDNEWUSERCLIENT("jose","1234");
call ADDNEWUSERCLIENT("dani","1234");
call ADDNEWUSERCLIENT("roberto","1234");
call ADDNEWUSERCLIENT("gabriel","1234");


CREATE PROCEDURE ADDNEWUSEREMPL(IN IN_USERNAME VARCHAR(20), 
                            IN IN_USERPASSWORD VARCHAR(15))
BEGIN
     #HAY QUE HACERLO, AUN FALTA 
END //
DELIMITER ;

DELIMITER //
#VERIFICAR LOGIN
CREATE PROCEDURE LOGINUSER(IN IN_USERNAME VARCHAR(20), 
						   IN IN_USERPASSWORD VARCHAR(15),
						   OUT IN_TYPEUSER INT)
BEGIN
    DECLARE CONT INTEGER DEFAULT 0;
	
	SELECT COUNT(USERNAME),USERTYPE
	INTO CONT,IN_TYPEUSER
	FROM UsersClient 
	WHERE IN_USERNAME = USERNAME AND IN_USERPASSWORD = USERPASSWORD;
    
    IF(CONT = 0) THEN 
		SELECT COUNT(USERNAME),USERTYPE
	    INTO CONT,IN_TYPEUSER
	    FROM UsersEmpl 
	    WHERE IN_USERNAME = USERNAME AND IN_USERPASSWORD = USERPASSWORD;
        IF(CONT = 0) THEN
         SET IN_TYPEUSER := -1;
		END IF;
    END IF;
    
END //
DELIMITER ;

DELIMITER //
#GET USUARIOS
CREATE PROCEDURE GETUSERS()
BEGIN
	SELECT USERNAME, USERPASSWORD,USERTYPE
	FROM UsersEmpl
    UNION
    SELECT USERNAME, USERPASSWORD,USERTYPE
    FROM UsersClient;
END //
DELIMITER ;

DELIMITER //
CREATE PROCEDURE GETPRODUCTOS()
BEGIN
	SELECT *
    FROM Producto;
END //
DELIMITER ;

DELIMITER //
#Agregar PRODUCTO
CREATE PROCEDURE ADDNEWPRODUCTO(IN IN_NOMBRE VARCHAR(30), 
                            IN IN_ACTIVO BOOLEAN,
                            IN IN_PRECIO DECIMAL(10,2),
                            IN IN_DESCRIPCION VARCHAR(50))
BEGIN
	INSERT INTO Producto(NOMBRE,ACTIVO, PRECIO, DESCRIPCION)
	VALUES(IN_NOMBRE, IN_ACTIVO, IN_PRECIO, IN_DESCRIPCION);
END //
DELIMITER ;

DELIMITER //
#Agregar PRODUCTO
CREATE PROCEDURE SETDISPPRODUCTO(IN IN_NOMBRE VARCHAR(30), 
                            IN IN_ACTIVO BOOLEAN)
BEGIN
	UPDATE Producto
    SET ACTIVO = IN_ACTIVO
    WHERE NOMBRE = IN_NOMBRE;
END //
DELIMITER ;



call addnewproducto("Coca-Cola",false,700,"Refrescante bebida carbonatada.");
call setdispproducto("Coca-Cola", true);

DELIMITER //
CREATE PROCEDURE GETCOMBOS()
BEGIN
	SELECT *
    FROM Combo;
END //
DELIMITER ;

DELIMITER //
#Agregar PRODUCTO
CREATE PROCEDURE ADDNEWCOMBO(IN IN_NOMBRE VARCHAR(30), 
                            IN IN_ACTIVO BOOLEAN,
                            IN IN_PRECIO DECIMAL(10,2),
                            IN IN_DESCRIPCION VARCHAR(50))
BEGIN
	INSERT INTO Combo(NOMBRE,ACTIVO, PRECIO, DESCRIPCION)
	VALUES(IN_NOMBRE, IN_ACTIVO, IN_PRECIO, IN_DESCRIPCION);
END //
DELIMITER ;

DELIMITER //
#Agregar PRODUCTO
CREATE PROCEDURE SETDISCOMBO(IN IN_NOMBRE VARCHAR(30), 
                            IN IN_ACTIVO BOOLEAN)
BEGIN
	UPDATE Combo
    SET ACTIVO = IN_ACTIVO
    WHERE NOMBRE = IN_NOMBRE;
END //
DELIMITER ;
call addnewcombo("Pobre",false,3500,"Combo para universitarios.");
call getcombos();
call setdiscombo("Pobre",true);




